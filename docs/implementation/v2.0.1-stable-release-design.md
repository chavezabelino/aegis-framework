<!--
@aegisFrameworkVersion: 2.0.1
@intent: Design specification for stable release system and packaged distribution
@context: Enhancement from v2.0.0-alpha to v2.0.1 with production-ready packaging
-->

# ðŸŽ¯ Aegis Framework v2.0.1: Stable Release System Design

## ðŸ“‹ Enhancement Overview

**Objective**: Transform Aegis Framework from alpha development to production-ready stable releases with packaged distribution.

**Current State**: v2.0.0-alpha-dev (single command hydration implemented)  
**Target State**: v2.0.1-stable (stable release system with packaged distribution)

## ðŸ—ï¸ Solution Architecture

### **1. Release Management System**

#### **Version Strategy**
```
Stable Releases:    v2.0.1, v2.0.2, v2.0.3...
Alpha Releases:     v2.1.0-alpha.1, v2.1.0-alpha.2...
Beta Releases:      v2.1.0-beta.1, v2.1.0-beta.2...  
Release Candidates: v2.1.0-rc.1, v2.1.0-rc.2...
```

#### **Release Channels**
- **`stable`**: Production-ready releases
- **`beta`**: Feature-complete pre-releases
- **`alpha`**: Development releases with new features
- **`nightly`**: Automated daily builds from main branch

### **2. Packaged Distribution System**

#### **Distribution Formats**
1. **Standalone CLI Package**: Self-contained hydration tool
2. **Framework Library Package**: Full framework for customization
3. **Docker Container**: Containerized deployment
4. **GitHub Releases**: Versioned downloadable packages

#### **Package Contents**
```
aegis-framework-v2.0.1-stable/
â”œâ”€â”€ bin/
â”‚   â”œâ”€â”€ aegis-hydrate           # Main CLI tool
â”‚   â”œâ”€â”€ aegis-conductor         # Governance automation
â”‚   â””â”€â”€ aegis-validate          # Validation tools
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ framework/              # Core framework files
â”‚   â”œâ”€â”€ templates/              # Blueprint templates
â”‚   â””â”€â”€ tools/                  # Validation and tooling
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ getting-started.md      # Quick start guide
â”‚   â”œâ”€â”€ api-reference.md        # CLI documentation
â”‚   â””â”€â”€ examples/               # Usage examples
â”œâ”€â”€ package.json                # NPM package configuration
â”œâ”€â”€ VERSION                     # Release version
â”œâ”€â”€ CHANGELOG.md               # Release notes
â”œâ”€â”€ LICENSE                    # License information
â””â”€â”€ README.md                  # Package overview
```

### **3. Build and Release Pipeline**

#### **GitHub Actions Workflow**
```yaml
# .github/workflows/release.yml
name: Release
on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      release_type:
        description: 'Release type'
        required: true
        default: 'patch'
        type: choice
        options:
          - patch
          - minor
          - major
          - prerelease
```

#### **Build Process**
1. **Pre-build Validation**: Constitutional compliance, test suite, lint checks
2. **Package Generation**: Create NPM-compatible packages with dependency declarations
3. **NPM Package Creation**: Generate packages following Node.js CLI standards
4. **Docker Image**: Build containerized version (only place where bundling is appropriate)
5. **Release Artifacts**: Upload source tarballs to GitHub Releases
6. **NPM Publishing**: Publish to npm registry with automatic dependency resolution

**âš ï¸ Design Evolution Note**: Initial design incorrectly suggested dependency bundling. Following user feedback (EVS-2025-08-07-008), corrected to industry-standard NPM dependency declaration approach.

### **4. Installation Methods**

#### **NPM Installation (Recommended)**
```bash
# Prerequisites: Node.js >= 18.0.0, npm >= 8.0.0

# Install globally - NPM handles all dependencies automatically
npm install -g @aegis-framework/cli@2.0.1

# Use immediately
aegis-hydrate /path/to/your/project
aegis-conductor init
```

#### **From Source (For Development/Customization)**
```bash
# Prerequisites: Node.js >= 18.0.0, npm >= 8.0.0, git

# Clone and install
git clone https://github.com/aegis-framework/aegis-framework.git
cd aegis-framework
npm install  # Installs all dependencies automatically

# Use directly
./cli/aegis-hydrate.ts /path/to/project
```

#### **Docker (For Isolated Environments)**
```bash
# Prerequisites: Docker >= 20.0.0

# Run hydration (dependencies bundled in container)
docker run --rm -v $(pwd):/workspace aegis-framework/cli:2.0.1 hydrate /workspace
```

## ðŸ”§ Implementation Plan

### **Phase 1: Version Management (Week 1)**

#### **1.1 Update Version System**
- Synchronize VERSION file and package.json
- Implement semantic versioning automation
- Create version validation tools

#### **1.2 Release Preparation Tools**
- Build script for package generation
- Automated changelog generation
- Release notes automation

### **Phase 2: Package Distribution (Week 2)**

#### **2.1 NPM CLI Package (Corrected Approach)**
- Extract core CLI functionality to clean package structure
- Declare dependencies in package.json (industry standard)
- Create NPM-compatible package following Node.js conventions
- **Evolution Note**: Removed incorrect bundling approach per EVS-2025-08-07-008

#### **2.2 Framework Library Package**
- Separate core framework from development files
- Create installable library package for customization
- Documentation for framework extension and modification

### **Phase 3: Release Automation (Week 3)**

#### **3.1 GitHub Actions Pipeline**
- Automated testing and validation
- Package building and artifact generation
- Release publishing automation

#### **3.2 Distribution Channels**
- NPM package publishing
- GitHub Releases setup
- Docker Hub integration

### **Phase 4: Documentation & Testing (Week 4)**

#### **4.1 Installation Documentation**
- Getting started guides
- Installation methods documentation
- Migration guides from alpha versions

#### **4.2 Integration Testing**
- Test installation methods
- Validate package functionality
- End-to-end release workflow testing

## ðŸ“Š Success Metrics

### **Technical Metrics**
- Package size < 1MB for NPM CLI package (achieved: 83KB)
- Installation time < 30 seconds via NPM
- Zero dependency conflicts (NPM handles resolution automatically)
- 100% functionality parity with development version

### **User Experience Metrics**
- One-command installation: `npm install -g @aegis-framework/cli`
- Quick start time: < 5 minutes from install to first hydration
- Clear upgrade path from any version
- Comprehensive documentation coverage

### **Release Quality Metrics**
- Automated testing coverage > 90%
- Zero critical bugs in stable releases
- Backward compatibility for CLI interface
- Constitutional compliance maintained

## ðŸš€ Implementation Roadmap

| Week | Focus | Deliverables |
|------|-------|--------------|
| **Week 1** | Version Management | Version sync, release tools, changelog automation |
| **Week 2** | Package Creation | Standalone CLI, library package, Docker image |
| **Week 3** | Release Pipeline | GitHub Actions, NPM publishing, artifact generation |
| **Week 4** | Testing & Docs | Installation guides, integration testing, release validation |

**Timeline**: 4 weeks to v2.0.1-stable  
**Release Date**: September 4, 2025

## ðŸŽ¯ User Scenarios

### **Scenario 1: Quick Start User**
```bash
# Install globally
npm install -g @aegis-framework/cli

# Hydrate existing project
aegis-hydrate /path/to/my/project
```

### **Scenario 2: Custom Framework User**
```bash
# Clone and customize
git clone https://github.com/aegis-framework/aegis-framework.git
cd aegis-framework

# Install dependencies
npm install

# Customize framework
# ... make modifications ...

# Build custom package
npm run build:package

# Use custom package
./dist/bin/aegis-hydrate /path/to/project
```

### **Scenario 3: Enterprise Docker User**
```bash
# Add to Dockerfile
FROM aegis-framework/cli:2.0.1 as aegis
FROM node:18
COPY --from=aegis /usr/local/bin/aegis-* /usr/local/bin/

# Use in CI/CD
RUN aegis-hydrate /workspace --auto-approve
```

This design provides a comprehensive solution for stable releases and packaged distribution while maintaining the framework's constitutional governance principles and ensuring easy adoption across different user scenarios.

## ðŸ“š Design Evolution Notes

### **Dependency Strategy Correction (August 7, 2025)**
**Evolution Story**: EVS-2025-08-07-008 - Dependency Bundling Drift and Correction

**Original Design Issue**: Initial specification incorrectly suggested dependency bundling for "standalone" CLI packages, which violated Node.js CLI distribution standards.

**User-Driven Correction**: Field user identified that dependencies should be prerequisites managed by NPM, not bundled files.

**Impact**: 
- âœ… Reduced package size from 1MB+ to 83KB
- âœ… Aligned with industry standards (TypeScript, ESLint, Angular CLI)  
- âœ… Simplified build process and maintenance
- âœ… Improved user experience with standard NPM installation

**Key Learning**: User expertise in open source distribution > framework assumptions. Always validate against industry standards before implementing custom solutions.
